<!-- ì‹œìŠ¤í…œí˜„í™© ì½˜í…ì¸  -->
<div class="stats-grid-enhanced">
    <div class="stat-card-large">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-info">
            <div class="stat-number" id="totalUsers">-</div>
            <div class="stat-label">ì „ì²´ ì‚¬ìš©ì</div>
        </div>
    </div>
    <div class="stat-card-large">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-info">
            <div class="stat-number" id="totalStudents">-</div>
            <div class="stat-label">í•™ìƒ</div>
        </div>
    </div>
    <div class="stat-card-large">
        <div class="stat-icon">ğŸ‘¨â€ğŸ«</div>
        <div class="stat-info">
            <div class="stat-number" id="totalTeachers">-</div>
            <div class="stat-label">êµì‚¬</div>
        </div>
    </div>
    <div class="stat-card-large">
        <div class="stat-icon">ğŸ“ˆ</div>
        <div class="stat-info">
            <div class="stat-number" id="utilizationRate">-</div>
            <div class="stat-label">ì´ìš©ë¥ </div>
        </div>
    </div>
</div>

<script>
// ë™ì  í†µê³„ ë°ì´í„° ë¡œë“œ
(function() {
    // DOMì´ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°
    function waitForDOM() {
        const elements = {
            totalUsers: document.getElementById('totalUsers'),
            totalStudents: document.getElementById('totalStudents'),
            totalTeachers: document.getElementById('totalTeachers'),
            utilizationRate: document.getElementById('utilizationRate')
        };
        
        // ëª¨ë“  ìš”ì†Œê°€ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (elements.totalUsers && elements.totalStudents && elements.totalTeachers && elements.utilizationRate) {
            loadAndDisplayStats(elements);
        } else {
            setTimeout(waitForDOM, 50);
        }
    }
    
    // í†µê³„ ë°ì´í„° ë¡œë“œ ë° í‘œì‹œ
    function loadAndDisplayStats(elements) {
        fetch('/dashboard/api/stats', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success && data.stats) {
                // ì‹¤ì œ API ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
                elements.totalUsers.textContent = data.stats.total_users || 0;
                elements.totalStudents.textContent = data.stats.total_students || 0;
                elements.totalTeachers.textContent = data.stats.total_teachers || 0;
                
                // ì´ìš©ë¥  ê³„ì‚° (í•™ìƒìˆ˜ ê¸°ì¤€)
                const utilizationRate = data.stats.total_students && data.stats.total_users 
                    ? Math.round((data.stats.total_students / data.stats.total_users) * 100)
                    : 0;
                elements.utilizationRate.textContent = utilizationRate + '%';
            } else {
                // API ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’
                elements.totalUsers.textContent = '0';
                elements.totalStudents.textContent = '0';
                elements.totalTeachers.textContent = '0';
                elements.utilizationRate.textContent = '0%';
            }
        })
        .catch(error => {
            // ì—°ê²° ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’
            elements.totalUsers.textContent = '0';
            elements.totalStudents.textContent = '0';
            elements.totalTeachers.textContent = '0';
            elements.utilizationRate.textContent = '0%';
        });
    }
    
    // DOM í™•ì¸ ì‹œì‘
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', waitForDOM);
    } else {
        waitForDOM();
    }
})();
</script>

