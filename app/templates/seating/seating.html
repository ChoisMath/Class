{% extends "base.html" %}

{% block title %}자리배치 관리{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/seating.css') }}">
{% endblock %}

{% block content %}
<div class="seating-container">
    <!-- 헤더 -->
    <div class="seating-header">
        <h1 class="page-title">자리배치 관리</h1>
        
        <!-- 컨트롤 패널 -->
        <div class="controls">
            <div class="control-group">
                <label for="date-picker">날짜:</label>
                <input type="date" id="date-picker" class="form-control" value="{{ today }}">
            </div>
            
            <div class="control-group">
                <label for="grade-select">학년:</label>
                <select id="grade-select" class="form-control">
                    <option value="1">1학년</option>
                    <option value="2">2학년</option>
                    <option value="3">3학년</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="period-select">교시:</label>
                <select id="period-select" class="form-control">
                    <option value="1">1교시</option>
                    <option value="2">2교시</option>
                    <option value="3">3교시</option>
                    <option value="4">4교시</option>
                    <option value="5">5교시</option>
                    <option value="6">6교시</option>
                    <option value="7">7교시</option>
                    <option value="11">자습1</option>
                    <option value="12">자습2</option>
                    <option value="13">자습3</option>
                    <option value="14">자습4</option>
                    <option value="15">자습5</option>
                </select>
            </div>
            
            <button id="load-data" class="btn btn-primary">데이터 로드</button>
            <button id="refresh-data" class="btn btn-secondary">새로고침</button>
        </div>
    </div>
    
    <!-- 범례 -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color present"></div>
            <span>출석</span>
        </div>
        <div class="legend-item">
            <div class="legend-color absent"></div>
            <span>부재</span>
        </div>
        <div class="legend-item">
            <div class="legend-color activity"></div>
            <span>활동 중</span>
        </div>
        <div class="legend-item">
            <div class="legend-color selected"></div>
            <span>선택됨</span>
        </div>
    </div>
    
    <!-- 자리배치 그리드 -->
    <div class="seat-layout">
        <div class="classroom-info">
            <h2 id="classroom-title">1학년 자율학습실</h2>
            <p class="classroom-desc">남쪽 출입구</p>
        </div>
        
        <div class="seat-grid" id="seat-grid">
            <!-- JavaScript로 동적 생성 -->
            <div class="loading">자리배치 데이터를 불러오는 중...</div>
        </div>
    </div>
    
    <!-- 부재 처리 패널 (교사/관리자만) -->
    {% if current_user.role in ['teacher', 'admin', 'super_admin'] %}
    <div class="absence-panel">
        <div class="panel-header">
            <h3>출석 관리</h3>
            <label class="selection-toggle">
                <input type="checkbox" id="selection-mode">
                <span>선택 모드</span>
            </label>
        </div>
        
        <div class="panel-actions">
            <button id="mark-absent" class="btn btn-danger" disabled>
                <i class="icon-x"></i> 부재 처리
            </button>
            <button id="mark-present" class="btn btn-success" disabled>
                <i class="icon-check"></i> 복귀 처리
            </button>
            <span id="selected-count" class="selected-count">선택된 학생: 0명</span>
        </div>
        
        <div class="recent-changes" id="recent-changes">
            <!-- 최근 변경사항 표시 -->
        </div>
    </div>
    {% endif %}
</div>

<!-- 모달 창들 -->
<div id="student-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="modal-title">학생 정보</h3>
        <div id="modal-body">
            <!-- 학생 상세 정보 -->
        </div>
        <div class="modal-actions">
            <button id="modal-close" class="btn btn-secondary">닫기</button>
        </div>
    </div>
</div>

<div id="notification" class="notification">
    <div class="notification-content">
        <span id="notification-message"></span>
        <button id="notification-close" class="notification-close">&times;</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/seating-manager.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        window.seatingManager = new SeatingManager({
            isTeacher: {{ 'true' if current_user.role in ['teacher', 'admin', 'super_admin'] else 'false' }},
            userId: '{{ current_user.id }}',
            userName: '{{ current_user.name }}'
        });
    });
</script>
{% endblock %}